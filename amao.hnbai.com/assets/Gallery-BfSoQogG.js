import{_ as c,r as o,j as r,a as T}from"./index-CEbc9sVW.js";const f=i=>Object.keys(i).map(l=>{const s=l.split("/gallery/").pop()??"",g=l.split("/").pop()??l,a=s.replace(/\.[^/.]+$/,"");return{src:`/img/gallery/${s}`,thumbSrc:`/img/gallery-optimized/thumb/${a}.jpg`,fullSrc:`/img/gallery-optimized/full/${a}.jpg`,title:k(g)}}).sort((l,s)=>l.title.localeCompare(s.title,void 0,{numeric:!0})),k=i=>i.replace(/\.[^/.]+$/,"").replace(/[-_]+/g," "),L=Object.assign({"../../public/img/gallery/Ready2Go!.jpg":()=>c(()=>import("./Ready2Go!-BRvUAaEm.js"),[]),"../../public/img/gallery/沙漠使者.png":()=>c(()=>import("./沙漠使者-BO-JF5TQ.js"),[]),"../../public/img/gallery/疾风.jpg":()=>c(()=>import("./疾风-D-_RbM_x.js"),[]),"../../public/img/gallery/真拿你没办法.png":()=>c(()=>import("./真拿你没办法-BAKUoq0W.js"),[])}),N=Object.assign({"../../public/img/gallery/NSFW/早上起床来一发.png":()=>c(()=>import("./早上起床来一发-DzS_2j5F.js"),[])}),P=Object.assign({"../../public/img/gallery/NSFW/gore/屠宰.jpg":()=>c(()=>import("./屠宰-Kjb06TwL.js"),[])}),O=f(L),R=f(N),$=f(P);function I(){const[i,l]=o.useState({open:!1,src:"",fallbackSrc:"",caption:""}),[s,g]=o.useState(!1),[a,b]=o.useState(!1),[d,m]=o.useState("idle"),y=o.useRef(null),p=o.useRef([]),_=s?a?$:R:O,x=e=>{const t=e.currentTarget;t.naturalWidth<=t.naturalHeight?t.classList.add("portrait"):t.classList.remove("portrait")};o.useEffect(()=>{if(!i.open)return;const e=t=>{t.key==="Escape"&&l(n=>({...n,open:!1}))};return document.addEventListener("keyup",e),()=>document.removeEventListener("keyup",e)},[]),o.useEffect(()=>{!s&&a&&b(!1)},[s,a]);const h=(e,t)=>{if(d!=="idle")return;p.current.forEach(S=>window.clearTimeout(S)),p.current=[],m("out");const n=450,u=900,w=window.setTimeout(()=>{g(e),b(e?t:!1),m("in")},n),v=window.setTimeout(()=>{m("idle")},u);p.current.push(w,v)};o.useEffect(()=>()=>{p.current.forEach(e=>window.clearTimeout(e))},[]);const E=e=>{e.target.id==="lightbox"&&l(n=>({...n,open:!1}))},j=e=>{l({open:!0,src:e.fullSrc,fallbackSrc:e.src,caption:e.title??""})};return r.jsxs("section",{id:"gallery",className:"container","aria-labelledby":"gallery-title",children:[r.jsxs("div",{className:"gallery-header",children:[r.jsx("h2",{id:"gallery-title",children:"Gallery"}),r.jsxs("div",{className:"gallery-controls",children:[r.jsx("button",{type:"button",className:`toggle-btn ${s?"is-active":""}`,"aria-pressed":s,onClick:()=>h(!s,a),disabled:d!=="idle",children:"NSFW"}),s&&r.jsx("button",{type:"button",className:`toggle-btn ${a?"is-active":""}`,"aria-pressed":a,onClick:()=>h(s,!a),disabled:d!=="idle",children:"Gore"})]})]}),r.jsx("div",{className:`gallery grid ${d!=="idle"?"is-transitioning":""} is-${d}`,ref:y,children:_.map((e,t)=>r.jsxs("figure",{onClick:()=>j(e),children:[r.jsx("img",{src:e.thumbSrc,srcSet:`${e.thumbSrc} 640w, ${e.fullSrc} 1600w`,sizes:"(max-width: 768px) 46vw, (max-width: 1200px) 30vw, 240px",width:240,height:270,onLoad:x,loading:"lazy",decoding:"async",onError:n=>{const u=n.currentTarget;u.dataset.fallbackApplied!=="1"&&(u.dataset.fallbackApplied="1",u.src=e.src)}}),r.jsx("figcaption",{children:e.title})]},t))}),typeof document<"u"&&T.createPortal(r.jsx("div",{id:"lightbox",className:i.open?"open":"","aria-hidden":i.open?"false":"true",onClick:E,children:r.jsxs("figure",{children:[i.open&&r.jsx("img",{src:i.src,loading:"eager",decoding:"async",onError:e=>{const t=e.currentTarget;t.dataset.fallbackApplied!=="1"&&(t.dataset.fallbackApplied="1",t.src=i.fallbackSrc)}}),r.jsx("figcaption",{children:i.caption})]})}),document.body)]})}export{I as default};
