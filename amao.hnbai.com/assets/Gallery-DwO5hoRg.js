import{_ as c,r as n,j as s,a as k}from"./index-DYDOa7MW.js";const m=l=>Object.keys(l).map(a=>{const r=a.split("/gallery/").pop()??"",p=a.split("/").pop()??a,i=r.replace(/\.[^/.]+$/,"");return{src:`/img/gallery/${r}`,thumbSrc:`/img/gallery-optimized/thumb/${i}.jpg`,fullSrc:`/img/gallery-optimized/full/${i}.jpg`,title:L(p)}}).sort((a,r)=>a.title.localeCompare(r.title,void 0,{numeric:!0})),L=l=>l.replace(/\.[^/.]+$/,"").replace(/[-_]+/g," "),N=Object.assign({"../../public/img/gallery/Ready2Go!.jpg":()=>c(()=>import("./Ready2Go!-BRvUAaEm.js"),[]),"../../public/img/gallery/沙漠使者.png":()=>c(()=>import("./沙漠使者-BO-JF5TQ.js"),[]),"../../public/img/gallery/疾风.jpg":()=>c(()=>import("./疾风-D-_RbM_x.js"),[]),"../../public/img/gallery/真拿你没办法.png":()=>c(()=>import("./真拿你没办法-BAKUoq0W.js"),[])}),P=Object.assign({"../../public/img/gallery/NSFW/早上起床来一发.png":()=>c(()=>import("./早上起床来一发-DzS_2j5F.js"),[])}),O=Object.assign({"../../public/img/gallery/NSFW/gore/屠宰.jpg":()=>c(()=>import("./屠宰-Kjb06TwL.js"),[])}),R=m(N),$=m(P),A=m(O);function D(){const[l,a]=n.useState({open:!1,src:"",fallbackSrc:"",caption:""}),[r,p]=n.useState(!1),[i,f]=n.useState(!1),[d,g]=n.useState("idle"),b=n.useRef(null),u=n.useRef([]),h=r?i?A:$:R,_=r?i?"gore":"nsfw":"safe",x=e=>{const t=e.currentTarget;t.naturalWidth<=t.naturalHeight?t.classList.add("portrait"):t.classList.remove("portrait")};n.useEffect(()=>{if(!l.open)return;const e=t=>{t.key==="Escape"&&a(o=>({...o,open:!1}))};return document.addEventListener("keyup",e),()=>document.removeEventListener("keyup",e)},[l.open]),n.useEffect(()=>{!r&&i&&f(!1)},[r,i]);const y=(e,t)=>{if(d!=="idle")return;u.current.forEach(T=>window.clearTimeout(T)),u.current=[],g("out");const o=450,w=900,v=window.setTimeout(()=>{p(e),f(e?t:!1),g("in")},o),S=window.setTimeout(()=>{g("idle")},w);u.current.push(v,S)};n.useEffect(()=>()=>{u.current.forEach(e=>window.clearTimeout(e))},[]);const E=e=>{e.target.id==="lightbox"&&a(o=>({...o,open:!1}))},j=e=>{a({open:!0,src:e.fullSrc,fallbackSrc:e.src,caption:e.title??""})};return s.jsxs("section",{id:"gallery",className:"container","aria-labelledby":"gallery-title",children:[s.jsxs("div",{className:"gallery-header",children:[s.jsx("h2",{id:"gallery-title",children:"Gallery"}),s.jsxs("div",{className:"gallery-controls",children:[s.jsx("button",{type:"button",className:`toggle-btn ${r?"is-active":""}`,"aria-pressed":r,onClick:()=>y(!r,i),disabled:d!=="idle",children:"NSFW"}),r&&s.jsx("button",{type:"button",className:`toggle-btn ${i?"is-active":""}`,"aria-pressed":i,onClick:()=>y(r,!i),disabled:d!=="idle",children:"Gore"})]})]}),s.jsx("div",{className:`gallery grid ${d!=="idle"?"is-transitioning":""} is-${d}`,ref:b,children:h.map(e=>s.jsxs("figure",{onClick:()=>j(e),children:[s.jsx("img",{src:e.thumbSrc,srcSet:`${e.thumbSrc} 640w, ${e.fullSrc} 1600w`,sizes:"(max-width: 768px) 46vw, (max-width: 1200px) 30vw, 240px",width:240,height:270,onLoad:x,loading:"lazy",decoding:"async",onError:t=>{const o=t.currentTarget;o.dataset.fallbackApplied!=="1"&&(o.dataset.fallbackApplied="1",o.src=e.src)}}),s.jsx("figcaption",{children:e.title})]},e.src))},_),typeof document<"u"&&k.createPortal(s.jsx("div",{id:"lightbox",className:l.open?"open":"","aria-hidden":l.open?"false":"true",onClick:E,children:s.jsxs("figure",{children:[l.open&&s.jsx("img",{src:l.src,loading:"eager",decoding:"async",onError:e=>{const t=e.currentTarget;t.dataset.fallbackApplied!=="1"&&(t.dataset.fallbackApplied="1",t.src=l.fallbackSrc)}}),s.jsx("figcaption",{children:l.caption})]})}),document.body)]})}export{D as default};
